# .github/workflows/test-negative.yml
name: Test DigitalOcean Registry Cleanup

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Missing doctl test
        env:
            MOCK_MODE: true
        run: |
          echo "Simulating missing doctl..."
          PATH="" ./cleanup.sh "7d" || echo "Test passed: 'doctl not installed' error displayed."

      - name: Unauthenticated doctl test
        env:
          MOCK_MODE: true
        run: |
          echo "Simulating unauthenticated doctl..."
          ./cleanup.sh "7d" || echo "Test passed: 'doctl not authenticated' error displayed."

      - name: Invalid age format test
        env:
            MOCK_MODE: true
        run: |
          echo "Testing invalid age format..."
          ./cleanup.sh "invalid" || echo "Test passed: 'invalid age format' error displayed."

      - name: Successful mock cleanup
        env:
          MOCK_MODE: true
        run: |
          echo "Running mock cleanup with valid input..."
          ./cleanup.sh "7d"